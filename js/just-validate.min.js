"use strict";function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}!function(){for(var e=["DocumentType","Element","CharacterData"],t=function(){null!=this.parentNode&&this.parentNode.removeChild(this)},r=0;r<e.length;r++){var i=e[r];window[i]&&!window[i].prototype.remove&&(window[i].prototype.remove=t)}}(),function(e){var t="required",r="email",i="minLength",s="maxLength",a="password",n="zip",o="phone",l="remote",u=function(e,t){if("string"==typeof e)return e;var r="post"===t.toLowerCase()?"":"?";return Array.isArray(e)?r+e.map(function(e){return e.name+"="+e.value}).join("&"):r+Object.keys(e).map(function(t){return t+"="+e[t]}).join("&")},d=function(e){var t=e.url,r=e.method,i=e.data,s=e.debug,a=e.callback,n=e.error;if(s)return void a("test");var o=e.async!==!1,l=new XMLHttpRequest,d=u(i,"get"),h=null;"post"===r.toLowerCase()&&(h=u(i,"post"),d=""),l.open(r,t+d,o),l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),l.onreadystatechange=function(){4===this.readyState&&(200===this.status?a(this.responseText):n(this.responseText))},l.send(h)},h=function(e,t){this.options=t||{},this.rules=this.options.rules||{},this.messages=this.options.messages||void 0,this.colorWrong=this.options.colorWrong||"#B81111",this.result={},this.elements=[],this.bindHandlerKeyup=this.handlerKeyup.bind(this),this.submitHandler=this.options.submitHandler||void 0,this.REGEXP={email:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,zip:/^\d{5}(-\d{4})?$/,phone:/^([0-9]( |-)?)?(\(?[0-9]{3}\)?|[0-9]{3})( |-)?([0-9]{3}( |-)?[0-9]{4}|[a-zA-Z0-9]{7})$/,password:/[^\w\d]*(([0-9]+.*[A-Za-z]+.*)|[A-Za-z]+.*([0-9]+.*))/},this.DEFAULT_REMOTE_ERROR="Error",this.DEFAULT_REMOTE_URL="http://localhost:7777/check-correct",this.setForm(document.querySelector(e))};h.prototype={defaultRules:{email:{required:!0,email:!0,remote:{url:"http://localhost:7777/check-correct",successAnswer:"OK",sendParam:"email",method:"GET"}},name:{required:!0,minLength:3,maxLength:15},text:{required:!0,maxLength:300,minLength:5},password:{required:!0,password:!0,minLength:4,maxLength:8},zip:{required:!0,zip:!0},phone:{phone:!0}},defaultMessages:{required:"The field is required",email:"Please, type a valid email",maxLength:"Too much",minLength:"Too short",password:"Password is not valid",remote:"Email already exists"},handlerKeyup:function(e){var t=e.target,r={name:t.getAttribute("data-validate-field"),value:t.value};delete this.result[r.name],this.validateItem({name:r.name,value:r.value}),this.renderErrors()},setterEventListener:function(e,t,r,i){switch("keyup"===t&&(r=this.bindHandlerKeyup),i){case"add":e.addEventListener(t,r);break;case"remove":e.removeEventListener(t,r)}},setForm:function(e){var t=this;this.$form=e,this.$form.setAttribute("novalidate","novalidate"),this.$form.addEventListener("submit",function(e){if(e.preventDefault(),t.result=[],t.getElements(),0===Object.keys(t.result).length)return t.submitHandler?void t.submitHandler(t.$form,t.elements,d):void t.$form.submit()})},isEmail:function(e){return this.REGEXP.email.test(e)},isZip:function(e){return this.REGEXP.zip.test(e)},isPhone:function(e){return this.REGEXP.phone.test(e)},isPassword:function(e){return this.REGEXP.password.test(e)},isEmpty:function(e){return!e},checkLengthMax:function(e,t){return e.length<=t},checkLengthMin:function(e,t){return e.length>t},getElements:function(){var e=this,t=this.$form.querySelectorAll("[data-validate-field]");this.elements=[];for(var r=0,i=t.length;r<i;++r){var s=t[r],a=s.getAttribute("data-validate-field"),n=s.value;"checkbox"===s.type&&(n=s.checked||"",s.addEventListener("change",function(t){var r=t.target,i={name:r.getAttribute("data-validate-field"),value:r.checked};delete e.result[i.name],e.validateItem({name:i.name,value:i.value}),e.renderErrors()})),this.setterEventListener(s,"keyup",this.handlerKeyup,"add"),this.elements.push({name:a,value:n})}this.validateElements()},validateRequired:function(e){return!this.isEmpty(e)},validateEmail:function(e){return this.isEmail(e)},validatePhone:function(e){return this.isPhone(e)},validateMinLength:function(e,t){return this.checkLengthMin(e,t)},validateMaxLength:function(e,t){return this.checkLengthMax(e,t)},validatePassword:function(e){return this.isPassword(e)},validateZip:function(e){return this.isZip(e)},validateRemote:function(e){var t=this,r=e.value,i=e.name,s=e.url,a=e.successAnswer,n=e.sendParam,o=e.method;d({url:s,method:o,data:_defineProperty({},n,r),async:!1,callback:function(e){e!==a&&(t.generateMessage(l,i),t.renderErrors())},error:function(){alert("Server error occured. Please try later."),t.generateMessage(l,i),t.renderErrors()}})},generateMessage:function(e,t){var r=this.messages||this.defaultMessages,i=r[t]&&r[t][e]||this.messages&&"string"==typeof this.messages[t]&&r[t]||this.defaultMessages[e]||this.DEFAULT_REMOTE_ERROR;this.result[t]={message:i}},validateElements:function(){var e=this;this.elements.forEach(function(t){e.validateItem({name:t.name,value:t.value})}),this.renderErrors()},validateItem:function(e){var u=e.name,d=e.value,h=this.rules[u]||this.defaultRules[u]||!1;if(h)for(var c in h){var m=h[c];switch(c){case t:if(!m)break;if(this.validateRequired(d))break;return void this.generateMessage(t,u);case r:if(!m)break;if(this.validateEmail(d))break;return void this.generateMessage(r,u);case i:if(!m)break;if(this.validateMinLength(d,m))break;return void this.generateMessage(i,u);case s:if(!m)break;if(this.validateMaxLength(d,m))break;return void this.generateMessage(s,u);case o:if(!m)break;if(this.validatePhone(d))break;return void this.generateMessage(o,u);case a:if(!m)break;if(this.validatePassword(d))break;return void this.generateMessage(a,u);case n:if(!m)break;if(this.validateZip(d))break;return void this.generateMessage(n,u);case l:if(!m)break;var v=m.url,f=m.successAnswer,g=m.method,p=m.sendParam,b=this.$form.querySelector('input[data-validate-field="'+u+'"]');return this.setterEventListener(b,"keyup",this.handlerKeyup,"remove"),void this.validateRemote({name:u,value:d,url:v,method:g,sendParam:p,successAnswer:f})}}},clearErrors:function(){for(var e=document.querySelectorAll(".js-validate-error-label"),t=0,r=e.length;t<r;++t)e[t].remove();e=document.querySelectorAll(".js-validate-error-field");for(var i=0,s=e.length;i<s;++i)e[i].classList.remove("js-validate-error-field"),e[i].style.border="",e[i].style.color=""},renderErrors:function(){if(this.clearErrors(),0===Object.keys(this.result).length)return void this._unblockSubmitBtn();for(var e in this.result)for(var t=this.result[e].message,r=this.$form.querySelectorAll('[data-validate-field="'+e+'"'),i=0,s=r.length;i<s;++i){var a=document.createElement("div"),n=r[i];if(a.innerHTML=t,a.className="js-validate-error-label",a.setAttribute("style","color: "+this.colorWrong),n.style.border="1px solid "+this.colorWrong,n.style.color=""+this.colorWrong,n.classList.add("js-validate-error-field"),"checkbox"!==n.type)n.parentNode.insertBefore(a,n.nextSibling);else{var o=document.querySelector('label[for="'+n.getAttribute("id")+'"]');"label"===n.parentNode.tagName.toLowerCase()?n.parentNode.parentNode.insertBefore(a,null):o?o.parentNode.insertBefore(a,o.nextSibling):n.parentNode.insertBefore(a,n.nextSibling)}}},_blockSubmitBtn:function(){var e=this.$form.querySelector('input[type="submit"]')||this.$form.querySelector("button");e.style.pointerEvents="none",e.style.webitFilter="grayscale(100%)",e.style.filter="grayscale(100%)",e.setAttribute("disabled","disabled")},_unblockSubmitBtn:function(){var e=this.$form.querySelector('input[type="submit"]')||this.$form.querySelector("button");e.style.pointerEvents="",e.style.webitFilter="",e.style.filter="",e.removeAttribute("disabled")}},e.JustValidate=h}(window);