"use strict";function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){for(var e=["DocumentType","Element","CharacterData"],t=function(){null!=this.parentNode&&this.parentNode.removeChild(this)},r=0;r<e.length;r++){var n=e[r];window[n]&&!window[n].prototype.remove&&(window[n].prototype.remove=t)}}(),function(e){function t(){}function r(e,t){return function(){e.apply(t,arguments)}}function n(e){if("object"!==_typeof(this))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],u(e,this)}function i(e,t){for(;3===e._state;)e=e._value;return 0===e._state?void e._deferreds.push(t):(e._handled=!0,void n._immediateFn(function(){var r=1===e._state?t.onFulfilled:t.onRejected;if(null===r)return void(1===e._state?s:o)(t.promise,e._value);var n;try{n=r(e._value)}catch(i){return void o(t.promise,i)}s(t.promise,n)}))}function s(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"===("undefined"==typeof t?"undefined":_typeof(t))||"function"==typeof t)){var i=t.then;if(t instanceof n)return e._state=3,e._value=t,void a(e);if("function"==typeof i)return void u(r(i,t),e)}e._state=1,e._value=t,a(e)}catch(s){o(e,s)}}function o(e,t){e._state=2,e._value=t,a(e)}function a(e){2===e._state&&0===e._deferreds.length&&n._immediateFn(function(){e._handled||n._unhandledRejectionFn(e._value)});for(var t=0,r=e._deferreds.length;t<r;t++)i(e,e._deferreds[t]);e._deferreds=null}function l(e,t,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=r}function u(e,t){var r=!1;try{e(function(e){r||(r=!0,s(t,e))},function(e){r||(r=!0,o(t,e))})}catch(n){if(r)return;r=!0,o(t,n)}}var d=setTimeout;n.prototype["catch"]=function(e){return this.then(null,e)},n.prototype.then=function(e,r){var n=new this.constructor(t);return i(this,new l(e,r,n)),n},n.all=function(e){var t=Array.prototype.slice.call(e);return new n(function(e,r){function n(s,o){try{if(o&&("object"===("undefined"==typeof o?"undefined":_typeof(o))||"function"==typeof o)){var a=o.then;if("function"==typeof a)return void a.call(o,function(e){n(s,e)},r)}t[s]=o,0===--i&&e(t)}catch(l){r(l)}}if(0===t.length)return e([]);for(var i=t.length,s=0;s<t.length;s++)n(s,t[s])})},n.resolve=function(e){return e&&"object"===("undefined"==typeof e?"undefined":_typeof(e))&&e.constructor===n?e:new n(function(t){t(e)})},n.reject=function(e){return new n(function(t,r){r(e)})},n.race=function(e){return new n(function(t,r){for(var n=0,i=e.length;n<i;n++)e[n].then(t,r)})},n._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){d(e,0)},n._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},n._setImmediateFn=function(e){n._immediateFn=e},n._setUnhandledRejectionFn=function(e){n._unhandledRejectionFn=e},"undefined"!=typeof module&&module.exports?module.exports=n:e.Promise||(e.Promise=n)}(window),function(e){e.Promise||(e.Promise=Promise);var t="required",r="email",n="minLength",i="maxLength",s="password",o="zip",a="phone",l="remote",u=function(e,t){if("string"==typeof e)return e;var r="post"===t.toLowerCase()?"":"?";return Array.isArray(e)?r+e.map(function(e){return e.name+"="+e.value}).join("&"):r+Object.keys(e).map(function(t){return t+"="+e[t]}).join("&")},d=function(e){var t=e.url,r=e.method,n=e.data,i=e.debug,s=e.callback,o=e.error;if(i)return void s("test");var a=e.async!==!1,l=new XMLHttpRequest,d=u(n,"get"),c=null;"post"===r.toLowerCase()&&(c=u(n,"post"),d=""),l.open(r,t+d,a),l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),l.onreadystatechange=function(){4===this.readyState&&(200===this.status?s(this.responseText):o(this.responseText))},l.send(c)},c=function(e,t){this.options=t||{},this.rules=this.options.rules||{},this.messages=this.options.messages||void 0,this.colorWrong=this.options.colorWrong||"#B81111",this.result={},this.elements=[],this.bindHandlerKeyup=this.handlerKeyup.bind(this),this.submitHandler=this.options.submitHandler||void 0,this.promiseRemote=null,this.isValidationSuccess=!1,this.REGEXP={email:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,zip:/^\d{5}(-\d{4})?$/,phone:/^([0-9]( |-)?)?(\(?[0-9]{3}\)?|[0-9]{3})( |-)?([0-9]{3}( |-)?[0-9]{4}|[a-zA-Z0-9]{7})$/,password:/[^\w\d]*(([0-9]+.*[A-Za-z]+.*)|[A-Za-z]+.*([0-9]+.*))/},this.DEFAULT_REMOTE_ERROR="Error",this.DEFAULT_REMOTE_URL="http://localhost:7777/check-correct",this.setForm(document.querySelector(e))};c.prototype={defaultRules:{email:{required:!0,email:!0,remote:{url:"http://localhost:7777/check-correct",successAnswer:"OK",sendParam:"email",method:"GET"}},name:{required:!0,minLength:3,maxLength:15},text:{required:!0,maxLength:300,minLength:5},password:{required:!0,password:!0,minLength:4,maxLength:8},zip:{required:!0,zip:!0},phone:{phone:!0}},defaultMessages:{required:"The field is required",email:"Please, type a valid email",maxLength:"The field must contain a maximum of :value characters",minLength:"The field must contain a minimum of :value characters",password:"Password is not valid",remote:"Email already exists"},handlerKeyup:function(e){var t=e.target,r={name:t.getAttribute("data-validate-field"),value:t.value};delete this.result[r.name],this.validateItem({name:r.name,value:r.value,isKeyupChange:!0}),this.renderErrors()},setterEventListener:function(e,t,r,n){switch("keyup"===t&&(r=this.bindHandlerKeyup),n){case"add":e.addEventListener(t,r);break;case"remove":e.removeEventListener(t,r)}},formPristine:function(){for(var e=this.$form.querySelectorAll("input, textarea"),t=0,r=e.length;t<r;++t)"submit"!==e[t].type&&(e[t].value="")},validationSuccess:function(){if(0===Object.keys(this.result).length){if(this.isValidationSuccess=!1,this.submitHandler)return this.submitHandler(this.$form,this.elements,d),void this.formPristine();this.$form.submit(),this.formPristine()}},setForm:function(e){var t=this;this.$form=e,this.$form.setAttribute("novalidate","novalidate"),this.$form.addEventListener("submit",function(e){return e.preventDefault(),t.result=[],t.getElements(),t.promiseRemote?void t.promiseRemote.then(function(){t.promiseRemote=null,t.isValidationSuccess&&t.validationSuccess()}):void(t.isValidationSuccess&&t.validationSuccess())})},isEmail:function(e){return this.REGEXP.email.test(e)},isZip:function(e){return this.REGEXP.zip.test(e)},isPhone:function(e){return this.REGEXP.phone.test(e)},isPassword:function(e){return this.REGEXP.password.test(e)},isEmpty:function(e){var t=e;return e.trim&&(t=e.trim()),!t},checkLengthMax:function(e,t){return e.length<=t},checkLengthMin:function(e,t){return e.length>=t},getElements:function(){var e=this,t=this.$form.querySelectorAll("[data-validate-field]");this.elements=[];for(var r=0,n=t.length;r<n;++r){var i=t[r],s=i.getAttribute("data-validate-field"),o=i.value;"checkbox"===i.type&&(o=i.checked||"",i.addEventListener("change",function(t){var r=t.target,n={name:r.getAttribute("data-validate-field"),value:r.checked};delete e.result[n.name],e.validateItem({name:n.name,value:n.value}),e.renderErrors()})),this.setterEventListener(i,"keyup",this.handlerKeyup,"add"),this.elements.push({name:s,value:o})}this.validateElements()},validateRequired:function(e){return!this.isEmpty(e)},validateEmail:function(e){return this.isEmail(e)},validatePhone:function(e){return this.isPhone(e)},validateMinLength:function(e,t){return this.checkLengthMin(e,t)},validateMaxLength:function(e,t){return this.checkLengthMax(e,t)},validatePassword:function(e){return this.isPassword(e)},validateZip:function(e){return this.isZip(e)},validateRemote:function(e){var t=e.value,r=e.name,n=e.url,i=e.successAnswer,s=e.sendParam,o=e.method;return new Promise(function(e){d({url:n,method:o,data:_defineProperty({},s,t),async:!0,callback:function(t){t.toLowerCase()===i.toLowerCase()&&e("ok"),e({type:"incorrect",name:r})},error:function(){e({type:"error",name:r})}})})},generateMessage:function(e,t,r){var n=this.messages||this.defaultMessages,i=n[t]&&n[t][e]||this.messages&&"string"==typeof this.messages[t]&&n[t]||this.defaultMessages[e]||this.DEFAULT_REMOTE_ERROR;r&&(i=i.replace(":value",r.toString())),this.result[t]={message:i}},validateElements:function(){var e=this;return this.lockForm(),this.elements.forEach(function(t){e.validateItem({name:t.name,value:t.value})}),this.promiseRemote?void this.promiseRemote.then(function(t){return"ok"===t?void e.renderErrors():("error"===t.type&&alert("Server error occured. Please try later."),e.generateMessage(l,t.name),void e.renderErrors())}):void this.renderErrors()},validateItem:function(e){var u=e.name,d=e.value,c=e.isKeyupChange,h=this.rules[u]||this.defaultRules[u]||!1;if(h)for(var f in h){var m=h[f];switch(f){case t:if(!m)break;if(this.validateRequired(d))break;return void this.generateMessage(t,u);case r:if(!m)break;if(this.validateEmail(d))break;return void this.generateMessage(r,u);case n:if(!m)break;if(this.validateMinLength(d,m))break;return void this.generateMessage(n,u,m);case i:if(!m)break;if(this.validateMaxLength(d,m))break;return void this.generateMessage(i,u,m);case a:if(!m)break;if(this.validatePhone(d))break;return void this.generateMessage(a,u);case s:if(!m)break;if(this.validatePassword(d))break;return void this.generateMessage(s,u);case o:if(!m)break;if(this.validateZip(d))break;return void this.generateMessage(o,u);case l:if(c)break;if(!m)break;var v=m.url,p=m.successAnswer,y=m.method,g=m.sendParam,b=this.$form.querySelector('input[data-validate-field="'+u+'"]');return this.setterEventListener(b,"keyup",this.handlerKeyup,"remove"),void(this.promiseRemote=this.validateRemote({name:u,value:d,url:v,method:y,sendParam:g,successAnswer:p}))}}},clearErrors:function(){for(var e=document.querySelectorAll(".js-validate-error-label"),t=0,r=e.length;t<r;++t)e[t].remove();e=document.querySelectorAll(".js-validate-error-field");for(var n=0,i=e.length;n<i;++n)e[n].classList.remove("js-validate-error-field"),e[n].style.border="",e[n].style.color=""},renderErrors:function(){if(this.clearErrors(),this.unlockForm(),this.isValidationSuccess=!1,0===Object.keys(this.result).length)return void(this.isValidationSuccess=!0);for(var e in this.result)for(var t=this.result[e].message,r=this.$form.querySelectorAll('[data-validate-field="'+e+'"'),n=0,i=r.length;n<i;++n){var s=document.createElement("div"),o=r[n];if(s.innerHTML=t,s.className="js-validate-error-label",s.setAttribute("style","color: "+this.colorWrong),o.style.border="1px solid "+this.colorWrong,o.style.color=""+this.colorWrong,o.classList.add("js-validate-error-field"),"checkbox"!==o.type)o.parentNode.insertBefore(s,o.nextSibling);else{var a=document.querySelector('label[for="'+o.getAttribute("id")+'"]');"label"===o.parentNode.tagName.toLowerCase()?o.parentNode.parentNode.insertBefore(s,null):a?a.parentNode.insertBefore(s,a.nextSibling):o.parentNode.insertBefore(s,o.nextSibling)}}},lockForm:function(){for(var e=this.$form.querySelectorAll("input, textarea, button, select"),t=0,r=e.length;t<r;++t)e[t].setAttribute("disabled","disabled"),e[t].style.pointerEvents="none",e[t].style.webitFilter="grayscale(100%)",e[t].style.filter="grayscale(100%)"},unlockForm:function(){for(var e=this.$form.querySelectorAll("input, textarea, button, select"),t=0,r=e.length;t<r;++t)e[t].removeAttribute("disabled"),e[t].style.pointerEvents="",e[t].style.webitFilter="",e[t].style.filter=""}},e.JustValidate=c}(window);